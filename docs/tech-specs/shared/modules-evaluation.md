# libs/shared æ¨¡å—è¯„ä»·æŠ¥å‘Š

> ç‰ˆæœ¬ï¼š1.0.0  
> æ›´æ–°æ—¥æœŸï¼š2026-02-22  
> è¯„ä»·èŒƒå›´ï¼šlibs/shared ä¸‹ 20 ä¸ªæ¨¡å—

---

## ä¸€ã€æ€»ä½“æ¦‚è§ˆ

### 1.1 å®Œæˆåº¦åˆ†å¸ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®Œæˆåº¦åˆ†å¸ƒ                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  100% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ kernel, config, logger, constants, exceptions   â”‚
â”‚        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ context, i18n, plugin, aggregate-metadata      â”‚
â”‚   95% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ messaging-postgres                              â”‚
â”‚   90% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  redis, analytics                                â”‚
â”‚   85% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   event-store                                     â”‚
â”‚   80% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    cqrs, ai-embeddings                             â”‚
â”‚   75% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     eda, authorization                              â”‚
â”‚   70% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      auth                                            â”‚
â”‚   60% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       database                                        â”‚
â”‚   50% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        messaging                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¨¡å—ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | æ¨¡å— |
|:---|:---:|:---|
| âœ… å®Œæˆå¯ç”¨ï¼ˆâ‰¥95%ï¼‰ | 10 | kernel, config, logger, constants, exceptions, context, i18n, plugin, aggregate-metadata, messaging-postgres |
| ğŸŸ¡ éœ€å®Œå–„ï¼ˆ70%-94%ï¼‰ | 8 | redis, analytics, event-store, ai-embeddings, cqrs, authorization, eda, auth |
| ğŸ”´ éœ€é‡ç‚¹æŠ•å…¥ï¼ˆ<70%ï¼‰ | 2 | database, messaging |

### 1.3 ä»£ç ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|:---|:---|
| æºç æ–‡ä»¶æ•° | 112 ä¸ª |
| æµ‹è¯•æ–‡ä»¶æ•° | 60 ä¸ª |
| ä»£ç æ€»è¡Œæ•° | ~15,000 è¡Œ |
| æ ¸å¿ƒæ¨¡å—æµ‹è¯•é€šè¿‡ | 330+ tests |

---

## äºŒã€æ¨¡å—è¯¦ç»†è¯„ä»·

### 2.1 æ ¸å¿ƒåŸºç¡€è®¾æ–½æ¨¡å—

#### @oksai/kernel

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 8 |
| **æµ‹è¯•æ–‡ä»¶** | 7 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… AggregateRootï¼ˆèšåˆæ ¹åŸºç±»ï¼Œæ”¯æŒé¢†åŸŸäº‹ä»¶ï¼‰
- âœ… Entityï¼ˆå®ä½“åŸºç±»ï¼‰
- âœ… ValueObjectï¼ˆå€¼å¯¹è±¡åŸºç±»ï¼‰
- âœ… DomainEventï¼ˆé¢†åŸŸäº‹ä»¶åŸºç±»ï¼‰
- âœ… UniqueEntityIDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
- âœ… Resultï¼ˆç»“æœæ¨¡å¼ï¼‰
- âœ… Guardï¼ˆæ–­è¨€å·¥å…·ï¼‰

**æµ‹è¯•è¦†ç›–ï¼š** 113 tests

**ä¾èµ–ï¼š** æ— å¤–éƒ¨ä¾èµ–

---

#### @oksai/config

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 5 |
| **æµ‹è¯•æ–‡ä»¶** | 2 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… ç±»å‹å®‰å…¨çš„ç¯å¢ƒå˜é‡è®¿é—®
- âœ… zod schema éªŒè¯
- âœ… å‘½åç©ºé—´é…ç½®
- âœ… ç¼“å­˜æœºåˆ¶
- âœ… ç¯å¢ƒæ£€æµ‹ï¼ˆisProduction/isDevelopment/isTestï¼‰
- âœ… å†…éƒ¨çº¯å‡½æ•°å±‚ï¼ˆenv-parsersï¼‰

**æµ‹è¯•è¦†ç›–ï¼š** 124 tests

**ä¾èµ–ï¼š** @nestjs/config, zod

---

#### @oksai/logger

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 4 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… å®ç° NestJS LoggerService æ¥å£
- âœ… Pino ç»“æ„åŒ–æ—¥å¿—
- âœ… è‡ªåŠ¨æ³¨å…¥ç§Ÿæˆ·ä¸Šä¸‹æ–‡
- âœ… å­æ—¥å¿—å™¨æ”¯æŒ
- âœ… è¯·æ±‚/å“åº”/é”™è¯¯åºåˆ—åŒ–
- âœ… å¯é€‰çš„ pino-pretty ç¾åŒ–è¾“å‡º

**æµ‹è¯•è¦†ç›–ï¼š** 60 tests

**ä¾èµ–ï¼š** nestjs-pino, pino, @oksai/context

---

#### @oksai/constants

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 3 |
| **æµ‹è¯•æ–‡ä»¶** | 2 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… API ç›¸å…³å¸¸é‡ï¼ˆç«¯å£ã€è·¯å¾„ã€è¶…æ—¶ç­‰ï¼‰
- âœ… åå°„å…ƒæ•°æ®é”®å¸¸é‡ï¼ˆè£…é¥°å™¨ä½¿ç”¨ï¼‰
- âœ… ç§Ÿæˆ·/è®¤è¯/åˆ†é¡µå¸¸é‡

**æµ‹è¯•è¦†ç›–ï¼š** 33 tests

**ä¾èµ–ï¼š** é›¶ä¾èµ–

---

#### @oksai/exceptions

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 2 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… DomainExceptionï¼ˆé¢†åŸŸå¼‚å¸¸ï¼‰
- âœ… ApplicationExceptionï¼ˆåº”ç”¨å¼‚å¸¸ï¼‰
- âœ… InfrastructureExceptionï¼ˆåŸºç¡€è®¾æ–½å¼‚å¸¸ï¼‰
- âœ… ValidationExceptionï¼ˆéªŒè¯å¼‚å¸¸ï¼‰
- âœ… BusinessRuleExceptionï¼ˆä¸šåŠ¡è§„åˆ™å¼‚å¸¸ï¼‰
- âœ… NotFoundExceptionï¼ˆèµ„æºæœªæ‰¾åˆ°å¼‚å¸¸ï¼‰

**æµ‹è¯•è¦†ç›–ï¼š** 12 tests

**ä¾èµ–ï¼š** é›¶ä¾èµ–

---

#### @oksai/context

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 4 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… TenantContext å€¼å¯¹è±¡
- âœ… AsyncLocalStorageProvider
- âœ… TenantContextService
- âœ… å¤šç§Ÿæˆ·ä¸Šä¸‹æ–‡ç®¡ç†

**æµ‹è¯•è¦†ç›–ï¼š** 9 tests

**ä¾èµ–ï¼š** æ— å¤–éƒ¨ä¾èµ–

---

### 2.2 äº‹ä»¶æº¯æºä¸ CQRS æ¨¡å—

#### @oksai/event-store

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 85% |
| **æºç æ–‡ä»¶** | 9 |
| **æµ‹è¯•æ–‡ä»¶** | 4 |
| **çŠ¶æ€** | ğŸŸ¡ éœ€å®Œå–„ |
| **ä¼˜å…ˆçº§** | **High** |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… EventStorePort æ¥å£
- âœ… StoredEvent å®ä½“
- âœ… EventStream å€¼å¯¹è±¡
- âœ… AI æ‰©å±•æ¥å£
- âœ… åŒæ­¥æ‰©å±•æ¥å£

**ç¼ºå¤±é¡¹ï¼š**
- âŒ PostgreSQL EventStore é€‚é…å™¨
- âŒ äº‹ä»¶åºåˆ—åŒ–å™¨å®ç°
- âŒ ä¹è§‚é”æ”¯æŒ

**å»ºè®®å¢å¼ºï¼š**
1. å®ç° `PostgresEventStore` é€‚é…å™¨
2. æ·»åŠ äº‹ä»¶å¿«ç…§æ”¯æŒ
3. æ·»åŠ äº‹ä»¶é‡æ”¾åŠŸèƒ½

---

#### @oksai/cqrs

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 80% |
| **æºç æ–‡ä»¶** | 7 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | ğŸŸ¡ éœ€å®Œå–„ |
| **ä¼˜å…ˆçº§** | **High** |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… Command åŸºç±»
- âœ… Query åŸºç±»
- âœ… CommandBusï¼ˆå†…å­˜å®ç°ï¼‰
- âœ… QueryBusï¼ˆå†…å­˜å®ç°ï¼‰
- âœ… ICommandHandler/IQueryHandler æ¥å£

**ç¼ºå¤±é¡¹ï¼š**
- âŒ NestJS æ¨¡å—å°è£…
- âŒ @CommandHandler/@QueryHandler è£…é¥°å™¨
- âŒ å¤„ç†å™¨è‡ªåŠ¨æ³¨å†Œ

**å»ºè®®å¢å¼ºï¼š**
1. åˆ›å»º `CqrsModule.forRoot()`
2. å®ç°è£…é¥°å™¨è‡ªåŠ¨æ³¨å†Œå¤„ç†å™¨
3. æ·»åŠ ä¸­é—´ä»¶æ”¯æŒ

---

#### @oksai/eda

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 75% |
| **æºç æ–‡ä»¶** | 4 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | ğŸŸ¡ éœ€å®Œå–„ |
| **ä¼˜å…ˆçº§** | Medium |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… IntegrationEvent åŸºç±»
- âœ… EventBusï¼ˆå†…å­˜å®ç°ï¼‰
- âœ… IEventHandler æ¥å£
- âœ… äº‹ä»¶å…ƒæ•°æ®

**ç¼ºå¤±é¡¹ï¼š**
- âŒ ä¸æ¶ˆæ¯é˜Ÿåˆ—çš„é›†æˆ
- âŒ é‡è¯•æœºåˆ¶
- âŒ æ­»ä¿¡é˜Ÿåˆ—
- âŒ äº‹ä»¶åºåˆ—åŒ–

**å»ºè®®å¢å¼ºï¼š**
1. é›†æˆ @oksai/messaging
2. æ·»åŠ é‡è¯•ç­–ç•¥
3. å®ç°æ­»ä¿¡é˜Ÿåˆ—å¤„ç†

---

### 2.3 æ•°æ®è®¿é—®ä¸æ¶ˆæ¯æ¨¡å—

#### @oksai/database

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 60% |
| **æºç æ–‡ä»¶** | 5 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | ğŸ”´ éœ€é‡ç‚¹æŠ•å…¥ |
| **ä¼˜å…ˆçº§** | **High** |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… DatabaseConfig å€¼å¯¹è±¡
- âœ… RepositoryBase æŠ½è±¡ç±»
- âœ… TransactionManager æ¥å£
- âœ… ConnectionPool æ¥å£
- âœ… ç±»å‹å®šä¹‰

**ç¼ºå¤±é¡¹ï¼š**
- âŒ MikroORM é›†æˆ
- âŒ TypeORM é›†æˆï¼ˆå¯é€‰ï¼‰
- âŒ è¿æ¥æ± å®ç°
- âŒ äº‹åŠ¡ç®¡ç†å™¨å®ç°
- âŒ å¥åº·æ£€æŸ¥

**å»ºè®®å¢å¼ºï¼š**
1. å®ç° `MikroOrmDatabaseModule`
2. å®ç° `MikroOrmTransactionManager`
3. æ·»åŠ è¿æ¥æ± é…ç½®
4. é›†æˆå¥åº·æ£€æŸ¥

---

#### @oksai/messaging

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 50% |
| **æºç æ–‡ä»¶** | 4 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | ğŸ”´ éœ€é‡ç‚¹æŠ•å…¥ |
| **ä¼˜å…ˆçº§** | **High** |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… IMessage æ¥å£
- âœ… IMessageProducer æ¥å£
- âœ… IMessageConsumer æ¥å£
- âœ… InMemoryMessageBusï¼ˆæµ‹è¯•ç”¨ï¼‰

**ç¼ºå¤±é¡¹ï¼š**
- âŒ Kafka é€‚é…å™¨
- âŒ RabbitMQ é€‚é…å™¨
- âŒ Redis Stream é€‚é…å™¨
- âŒ NestJS æ¨¡å—
- âŒ æ¶ˆæ¯åºåˆ—åŒ–

**å»ºè®®å¢å¼ºï¼š**
1. å®ç° `RedisStreamMessageBus`ï¼ˆæ¨èï¼‰
2. æˆ–å®ç° `KafkaMessageBus`
3. åˆ›å»º `MessagingModule`
4. æ·»åŠ æ¶ˆæ¯å‹ç¼©

---

#### @oksai/messaging-postgres

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 95% |
| **æºç æ–‡ä»¶** | 7 |
| **æµ‹è¯•æ–‡ä»¶** | 5 |
| **çŠ¶æ€** | ğŸŸ¡ åŸºæœ¬å®Œæˆ |
| **ä¼˜å…ˆçº§** | Low |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… PgOutbox å®ç°
- âœ… PgInbox å®ç°ï¼ˆå«å»é‡è¡¨ï¼‰
- âœ… Entity å®šä¹‰
- âœ… NestJS æ¨¡å—é…ç½®
- âœ… äº‹åŠ¡é›†æˆ

**ç¼ºå¤±é¡¹ï¼š**
- âš ï¸ æ¶ˆæ¯è°ƒåº¦å™¨ï¼ˆå®šæ—¶é‡è¯•ï¼‰

**å»ºè®®å¢å¼ºï¼š**
1. æ·»åŠ æ¶ˆæ¯è°ƒåº¦å™¨
2. æ·»åŠ ç›‘æ§æŒ‡æ ‡

---

### 2.4 è®¤è¯æˆæƒæ¨¡å—

#### @oksai/auth

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 70% |
| **æºç æ–‡ä»¶** | 4 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | ğŸŸ¡ éœ€å®Œå–„ |
| **ä¼˜å…ˆçº§** | **High** |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… PasswordHasherï¼ˆArgon2ï¼‰
- âœ… JwtTokenServiceï¼ˆç®€åŒ–å®ç°ï¼‰
- âœ… AuthenticationResult
- âœ… IAuthenticationPort æ¥å£

**ç¼ºå¤±é¡¹ï¼š**
- âŒ ç”Ÿäº§çº§ JWT å®ç°ï¼ˆåˆ·æ–°ä»¤ç‰Œã€é»‘åå•ï¼‰
- âŒ OAuth2 é›†æˆ
- âŒ NestJS Guard
- âŒ Session ç®¡ç†

**å»ºè®®å¢å¼ºï¼š**
1. å®Œå–„ JwtTokenService
2. æ·»åŠ  `JwtAuthGuard`
3. é›†æˆ better-auth æˆ– Auth0

---

#### @oksai/authorization

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 75% |
| **æºç æ–‡ä»¶** | 4 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | ğŸŸ¡ éœ€å®Œå–„ |
| **ä¼˜å…ˆçº§** | Medium |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… Permission å€¼å¯¹è±¡
- âœ… Role å€¼å¯¹è±¡
- âœ… AuthorizationService
- âœ… IAuthorizationPort æ¥å£

**ç¼ºå¤±é¡¹ï¼š**
- âŒ NestJS Guard
- âŒ åŠ¨æ€æƒé™åŠ è½½
- âŒ ç­–ç•¥å¼•æ“ï¼ˆCASL é›†æˆï¼‰
- âŒ æƒé™ç¼“å­˜

**å»ºè®®å¢å¼ºï¼š**
1. æ·»åŠ  `PermissionsGuard`
2. æ·»åŠ  `@RequirePermissions()` è£…é¥°å™¨
3. é›†æˆ CASL

---

### 2.5 åŸºç¡€è®¾æ–½æ¨¡å—

#### @oksai/redis

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 90% |
| **æºç æ–‡ä»¶** | 6 |
| **æµ‹è¯•æ–‡ä»¶** | 5 |
| **çŠ¶æ€** | ğŸŸ¡ åŸºæœ¬å®Œæˆ |
| **ä¼˜å…ˆçº§** | Low |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… setupRedisModule é…ç½®
- âœ… OksaiRedisHealthService
- âœ… AbstractRedisRepository
- âœ… ioredis é›†æˆ

**ç¼ºå¤±é¡¹ï¼š**
- âš ï¸ åˆ†å¸ƒå¼é”å®ç°

**å»ºè®®å¢å¼ºï¼š**
1. æ·»åŠ  `RedisLockService`

---

#### @oksai/i18n

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 2 |
| **æµ‹è¯•æ–‡ä»¶** | 1 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… setupI18nModule é…ç½®
- âœ… nestjs-i18n å°è£…

---

#### @oksai/plugin

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 6 |
| **æµ‹è¯•æ–‡ä»¶** | 4 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… @OksaiCorePlugin è£…é¥°å™¨
- âœ… æ’ä»¶å…ƒæ•°æ®
- âœ… ç”Ÿå‘½å‘¨æœŸé’©å­
- âœ… PluginModule

---

### 2.6 åˆ†æä¸ AI æ¨¡å—

#### @oksai/analytics

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 90% |
| **æºç æ–‡ä»¶** | 14 |
| **æµ‹è¯•æ–‡ä»¶** | 9 |
| **çŠ¶æ€** | ğŸŸ¡ åŸºæœ¬å®Œæˆ |
| **ä¼˜å…ˆçº§** | Medium |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… IAnalyticsReportService
- âœ… IDataQualityScorer
- âœ… ç»´åº¦è®¡ç®—å™¨
- âœ… NestJS Controller/Module

**ç¼ºå¤±é¡¹ï¼š**
- âš ï¸ ClickHouse é›†æˆ
- âš ï¸ å®æ—¶åˆ†æ

**å»ºè®®å¢å¼ºï¼š**
1. æ·»åŠ  ClickHouse è¯»æ¨¡å‹
2. æ·»åŠ å®æ—¶æŒ‡æ ‡è®¡ç®—

---

#### @oksai/ai-embeddings

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 80% |
| **æºç æ–‡ä»¶** | 4 |
| **æµ‹è¯•æ–‡ä»¶** | 3 |
| **çŠ¶æ€** | ğŸŸ¡ éœ€å®Œå–„ |
| **ä¼˜å…ˆçº§** | Medium |

**å·²æœ‰èƒ½åŠ›ï¼š**
- âœ… IEmbeddingService æ¥å£
- âœ… IVectorStore æ¥å£
- âœ… OpenAIEmbeddingService
- âœ… MockEmbeddingService

**ç¼ºå¤±é¡¹ï¼š**
- âš ï¸ PgVectorStore å®ç°å®Œå–„
- âŒ ç›¸ä¼¼æ€§æœç´¢ä¼˜åŒ–

**å»ºè®®å¢å¼ºï¼š**
1. å®Œå–„ PgVectorStore
2. æ·»åŠ æ‰¹é‡åµŒå…¥æ”¯æŒ

---

#### @oksai/aggregate-metadata

| å±æ€§ | å€¼ |
|:---|:---|
| **å®Œæˆåº¦** | 100% |
| **æºç æ–‡ä»¶** | 5 |
| **æµ‹è¯•æ–‡ä»¶** | 3 |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª |

**æ ¸å¿ƒèƒ½åŠ›ï¼š**
- âœ… IFullAggregateMetadata æ¥å£
- âœ… AggregateMetadataQueryService
- âœ… AggregateMetadataProjector
- âœ… å®Œæ•´çš„è·¨åŸŸå…ƒæ•°æ®æŸ¥è¯¢èƒ½åŠ›

---

## ä¸‰ã€å¢å¼ºä¼˜å…ˆçº§

### 3.1 High ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒæ¶æ„ä¾èµ–ï¼‰

| åºå· | æ¨¡å— | éœ€è¦å¢å¼ºçš„å†…å®¹ | é¢„ä¼°å·¥æ—¶ |
|:---:|:---|:---|:---:|
| 1 | **database** | MikroORM é›†æˆã€è¿æ¥æ± ç®¡ç†ã€äº‹åŠ¡ç®¡ç†å™¨ | 3-5 å¤© |
| 2 | **event-store** | PostgreSQL EventStore é€‚é…å™¨ | 2-3 å¤© |
| 3 | **cqrs** | NestJS æ¨¡å—ã€è£…é¥°å™¨ã€è‡ªåŠ¨æ³¨å†Œ | 2-3 å¤© |
| 4 | **auth** | ç”Ÿäº§çº§ JWTã€Guardã€åˆ·æ–°ä»¤ç‰Œ | 3-4 å¤© |
| 5 | **messaging** | Redis Stream é€‚é…å™¨ | 3-4 å¤© |

### 3.2 Medium ä¼˜å…ˆçº§ï¼ˆä¸šåŠ¡åŠŸèƒ½ï¼‰

| åºå· | æ¨¡å— | éœ€è¦å¢å¼ºçš„å†…å®¹ | é¢„ä¼°å·¥æ—¶ |
|:---:|:---|:---|:---:|
| 1 | **authorization** | Guardã€åŠ¨æ€æƒé™ã€CASL é›†æˆ | 2-3 å¤© |
| 2 | **eda** | æ¶ˆæ¯é˜Ÿåˆ—é›†æˆã€é‡è¯•æœºåˆ¶ | 2-3 å¤© |
| 3 | **analytics** | ClickHouse é›†æˆ | 3-4 å¤© |
| 4 | **ai-embeddings** | PGVector å®Œå–„ | 1-2 å¤© |

### 3.3 Low ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–é¡¹ï¼‰

| åºå· | æ¨¡å— | éœ€è¦å¢å¼ºçš„å†…å®¹ | é¢„ä¼°å·¥æ—¶ |
|:---:|:---|:---|:---:|
| 1 | **messaging-postgres** | æ¶ˆæ¯è°ƒåº¦å™¨ | 1 å¤© |
| 2 | **redis** | åˆ†å¸ƒå¼é” | 0.5 å¤© |

---

## å››ã€å»ºè®®å®æ–½è·¯å¾„

### Phase 1: æ ¸å¿ƒæ•°æ®å±‚ï¼ˆ1-2 å‘¨ï¼‰

```
ç›®æ ‡ï¼šè§£é”é¢†åŸŸå±‚æŒä¹…åŒ–èƒ½åŠ›

ä»»åŠ¡ï¼š
1. database æ¨¡å—å¢å¼º
   - å®ç° MikroOrmDatabaseModule
   - å®ç° MikroOrmTransactionManager
   - æ·»åŠ è¿æ¥æ± é…ç½®

2. event-store æ¨¡å—å¢å¼º
   - å®ç° PostgresEventStore
   - æ·»åŠ äº‹ä»¶åºåˆ—åŒ–å™¨
   - æ·»åŠ å¿«ç…§æ”¯æŒ
```

### Phase 2: CQRS + è®¤è¯ï¼ˆ1-2 å‘¨ï¼‰

```
ç›®æ ‡ï¼šå®Œå–„åº”ç”¨å±‚èƒ½åŠ›

ä»»åŠ¡ï¼š
1. cqrs æ¨¡å—å¢å¼º
   - åˆ›å»º CqrsModule.forRoot()
   - å®ç° @CommandHandler/@QueryHandler è£…é¥°å™¨
   - å¤„ç†å™¨è‡ªåŠ¨æ³¨å†Œ

2. auth æ¨¡å—å¢å¼º
   - å®Œå–„ JwtTokenService
   - åˆ›å»º JwtAuthGuard
   - æ·»åŠ åˆ·æ–°ä»¤ç‰Œæ”¯æŒ
```

### Phase 3: æ¶ˆæ¯ä¸æˆæƒï¼ˆ1-2 å‘¨ï¼‰

```
ç›®æ ‡ï¼šå®Œå–„äº‹ä»¶é©±åŠ¨å’Œæƒé™æ§åˆ¶

ä»»åŠ¡ï¼š
1. messaging æ¨¡å—å¢å¼º
   - å®ç° RedisStreamMessageBus
   - åˆ›å»º MessagingModule

2. authorization æ¨¡å—å¢å¼º
   - åˆ›å»º PermissionsGuard
   - å®ç° @RequirePermissions() è£…é¥°å™¨
   - é›†æˆ CASLï¼ˆå¯é€‰ï¼‰
```

### Phase 4: é«˜çº§èƒ½åŠ›ï¼ˆ2-4 å‘¨ï¼‰

```
ç›®æ ‡ï¼šå®Œå–„åˆ†æå’Œ AI èƒ½åŠ›

ä»»åŠ¡ï¼š
1. eda æ¨¡å—å¢å¼º - æ¶ˆæ¯é˜Ÿåˆ—é›†æˆ
2. analytics æ¨¡å—å¢å¼º - ClickHouse é›†æˆ
3. ai-embeddings æ¨¡å—å¢å¼º - PGVector å®Œå–„
```

---

## äº”ã€é£é™©ä¸å»ºè®®

### 5.1 å½“å‰é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|:---|:---|:---|
| database æ¨¡å—æœªå®Œæˆ | é˜»å¡æ‰€æœ‰é¢†åŸŸæŒä¹…åŒ– | ä¼˜å…ˆå®ç° MikroORM é›†æˆ |
| messaging æ¨¡å—æœªå®Œæˆ | é˜»å¡äº‹ä»¶é©±åŠ¨èƒ½åŠ› | å…ˆç”¨ messaging-postgres è¿‡æ¸¡ |
| auth æ¨¡å—ç®€åŒ–å®ç° | ç”Ÿäº§ç¯å¢ƒå®‰å…¨é£é™© | å°½å¿«å‡çº§ä¸ºç”Ÿäº§çº§å®ç° |

### 5.2 å»ºè®®

1. **ä¼˜å…ˆå®Œæˆ Phase 1**ï¼šdatabase å’Œ event-store æ˜¯æ‰€æœ‰é¢†åŸŸæ¨¡å—çš„åŸºç¡€
2. **ä¿æŒæµ‹è¯•è¦†ç›–**ï¼šæ¯ä¸ªå¢å¼ºæ¨¡å—éœ€è¦è¾¾åˆ° 80%+ æµ‹è¯•è¦†ç›–
3. **æ–‡æ¡£åŒæ­¥æ›´æ–°**ï¼šå¢å¼ºæ¨¡å—æ—¶åŒæ­¥æ›´æ–°æŠ€æœ¯è§„æ ¼æ–‡æ¡£
4. **æ¸è¿›å¼é›†æˆ**ï¼šå…ˆåœ¨ tenant/identity é¢†åŸŸéªŒè¯ï¼Œå†æ¨å¹¿

---

## å…­ã€ä¿®è®¢å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|:---|:---|:---|
| v1.0.0 | 2026-02-22 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæˆ 20 ä¸ªæ¨¡å—è¯„ä»· |
