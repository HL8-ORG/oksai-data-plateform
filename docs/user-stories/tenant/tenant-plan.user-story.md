# US-TN-002: 租户计划管理

## 用户故事

**As a** 租户管理员  
**I want** 升级或降级租户计划  
**So that** 获得适合业务规模的资源配额

---

## 业务规则

1. 计划升级立即生效
2. 计划降级在当前计费周期结束后生效
3. 只有活跃状态的租户可以变更计划
4. 计划变更触发领域事件

---

## 验收标准

### AC1: 升级计划

```gherkin
Given 一个使用 "free" 计划的活跃租户
When 升级到 "pro" 计划
Then 租户计划立即变为 "pro"
  And 触发 "TenantPlanUpgraded" 事件
```

### AC2: 降级计划

```gherkin
Given 一个使用 "pro" 计划的活跃租户
When 降级到 "free" 计划
Then 记录降级请求
  And 计划在当前周期结束后变更
  And 触发 "TenantPlanDowngradeRequested" 事件
```

### AC3: 已暂停租户不能变更计划

```gherkin
Given 一个已暂停的租户
When 尝试升级计划
Then 变更失败
  And 错误信息应包含 "租户已暂停"
```

---

## 计划对比

| 功能 | Free | Pro | Enterprise |
|:---|:---|:---|:---|
| 用户数 | 5 | 50 | 无限 |
| 存储空间 | 1GB | 50GB | 500GB |
| API 调用/天 | 1000 | 50000 | 无限 |
| 技术支持 | 社区 | 邮件 | 专属 |

---

## 修订历史

| 版本 | 日期 | 变更说明 |
|:---|:---|:---|
| v1.0 | 2026-02-21 | 初始版本 |
