# Identity 领域用户故事

## Epic: 用户身份管理

作为平台，我需要管理用户身份，以便为多租户 SaaS 提供安全可靠的用户管理能力。

---

## Story 1: 用户注册

**作为** 新用户  
**我想要** 使用邮箱注册账户  
**以便** 我可以访问平台服务

### 验收标准
- [ ] 邮箱必须符合格式要求
- [ ] 系统自动生成用户 ID
- [ ] 注册成功后用户处于活跃状态
- [ ] 触发 UserRegisteredEvent 事件

### 业务规则
- 邮箱不能为空
- 邮箱格式必须有效（包含@符号，符合基本格式）
- 邮箱自动转为小写存储

---

## Story 2: 用户禁用/启用

**作为** 系统管理员  
**我想要** 禁用或启用用户  
**以便** 控制用户对平台的访问

### 验收标准
- [ ] 禁用用户需要提供原因
- [ ] 已禁用用户不能执行需要活跃状态的操作
- [ ] 租户所有者不能被禁用
- [ ] 启用是禁用的逆操作

### 业务规则
- 禁用操作幂等
- 启用操作幂等
- 禁用/启用触发相应事件

---

## Story 3: 角色授予

**作为** 租户管理员  
**我想要** 为用户授予角色  
**以便** 用户获得相应权限

### 验收标准
- [ ] 只有活跃用户可以接受角色授予
- [ ] 用户不能重复获得相同角色
- [ ] 授予角色触发 RoleGrantedToUserEvent 事件

### 预定义角色
| 角色 | 说明 |
|:---|:---|
| PlatformAdmin | 平台管理员 |
| TenantOwner | 租户所有者 |
| TenantAdmin | 租户管理员 |
| TenantMember | 租户成员 |

### 业务规则
- 角色键必须是 PascalCase 格式
- 用户至少保留一个角色
- 管理员角色授予需要特殊条件

---

## Story 4: 角色撤销

**作为** 租户管理员  
**我想要** 撤销用户的角色  
**以便** 移除用户不再需要的权限

### 验收标准
- [ ] 只有活跃用户可以被撤销角色
- [ ] 不能撤销用户的最后一个角色
- [ ] 用户必须拥有该角色才能被撤销

### 业务规则
- 撤销角色后触发相应事件
- 最后一个角色不可撤销

---

## Story 5: 添加到租户

**作为** 系统管理员  
**我想要** 将用户添加到租户  
**以便** 用户可以访问租户资源

### 验收标准
- [ ] 用户可以属于多个租户
- [ ] 不能重复添加到同一租户
- [ ] 添加成功触发 UserAddedToTenantEvent 事件

---

## 优先级排序

| 优先级 | 故事 | 依赖 |
|:---:|:---|:---|
| P0 | 用户注册 | 无 |
| P0 | 用户禁用/启用 | 用户注册 |
| P1 | 角色授予 | 用户注册 |
| P1 | 角色撤销 | 角色授予 |
| P2 | 添加到租户 | 用户注册 |
